# 软件体系结构文档模板

## 文档修改历史

| 修改人员 | 日期         | 修改原因                                     | 版本号 |
| :------: | ------------ | -------------------------------------------- | ------ |
|  黄韫秀  | 2021年7月6日 | 添加了组合视图、5.3、5.4                     | v0.1.1 |
|  张蔚然  | 2021年7月6日 | 添加了模块的职责、用户界面层的分解、信息视角 | v0.1.2 |
|  黄韫秀  | 2021.7.7     | 修改了组合试图                               | v0.1.3 |
|          |              |                                              | v0.1.4 |

## 目录

[TOC]

## 引言

### 编制目的

1. 本文档详细完成了对互联网酒店预订系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通
2. 本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 参考资料

1. IEEE标准
2. 课程学习网站courselearning用例文档V1.0
3. 课程学习网站courselearning软件需求规格说明文档V1.0


## 产品概述

课程学习网站courselearning是为XXX教育团队（包括教师、网站经理）以及中国国内学生用户开发的web系统，开发的目标是帮助网站用户处理日常的重点业务，包括网站经理的课程销售、会员发展，教师用户的课程管理，学生用户的课程购买、课程学习。

通过课程学习网站courselearning的应用，期望为XXX教育团队提高教师及网站经理的工作效率，提高课程销售额；为学生用户降低课程购买、学习的操作难度，提高满意度。


## 逻辑视图

课程学习网站courselearning选择了分层体系结构风格，将系统分为3层(展示层、业务逻辑层、数据层)能够很好地示意整个高层抽象。展示层包含GUI页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的了逻辑视图和逻辑设计方案如下图所示。

- 参照体系结构风格的包图表达逻辑视角
  ![](http://assets.processon.com/chart_image/60aa222df346fb77770c4819.png)
- 软件体系结构逻辑设计方案

## 组合视图

### 开发包图

- 课程学习系统的开发包设计如表所示。

|       开发包        | 依赖的其他开发包                                 |
| :-----------------: | ------------------------------------------------ |
|       mainui        | userui、manageui、vo、clientui                   |
|       config        |                                                  |
|     controller      | vo、service、util                                |
|       userui        | vo、界面类库包、userblservice                    |
|    userblservice    |                                                  |
|       userbl        | userblservice、userdataservice、coursebl         |
|   userdataservice   | REST API、po                                     |
|      userdata       | po、databaseutility、userdataservice             |
|      courseui       | vo、界面类库包、courseblservice                  |
|   courseblservice   |                                                  |
|      coursebl       | courseblservice、coursedataservice、courseoderbl |
|  coursedataservice  | REST API、po                                     |
|     coursedata      | po、databaseutility、coursedataservice           |
|       fileui        | vo、界面类库包、fileblservice                    |
|    fileblservice    |                                                  |
|       filebl        | fileblservice、filedataservice                   |
|   filedataservice   | REST API、po                                     |
|      filedata       | po、databaseutility、filedataservice             |
|       oderui        | vo、界面类库包、oderblservice                    |
|    oderblservice    |                                                  |
|       oderbl        | oderblservice、oderdataservice、userbl           |
|   oderdataservice   | REST API、po                                     |
|      oderdata       | po、databaseutility、oderdataservice             |
|      couponui       | vo、界面类库包、couponblservice                  |
|   couponblservice   |                                                  |
|      couponbl       | couponblservice、coupondataservice、coursebl     |
|  coupondataservice  | REST API、po                                     |
|     coupondata      | po、databaseutility、coupondataservice           |
|    discussionui     | vo、界面类库包、discussionblservice              |
| discussionblservice |                                                  |
|    discussionbl     | discussionblservice、discussiondataservice       |
|  coupondataservice  | REST API、po                                     |
|     coupondata      | po、databaseutility、discussiondataservice       |
|        enums        |                                                  |
|      exception      | enums                                            |
|        util         | enums、exception、vo                             |
|         po          |                                                  |
|         vo          |                                                  |
|      utilitybl      |                                                  |
|     界面类库包      |                                                  |
|      REST API       |                                                  |
|   databaseutility   | JDBC                                             |

- 课程购买系统的开发包图如图所示。

![](https://b2.kuibu.net/file/imgdisk/imgs/2021/07/502fdee85517ac31.png)

![](https://b2.kuibu.net/file/imgdisk/imgs/2021/07/317bcb7ca907f525.png)

### 运行时进程

- 在系统中，会有多个客户端进程和一个服务器端进程，其进程图如图所示。结合部署图，客户端进程是在客户端机器上运行，服务器端进程在服务器端机器上运行。两者通过REST API通信。


### 物理部署

- 课程购买系统中客户端构件是放在客户端机器上，服务器端构件是放在服务
  器端机器上。在客户端节点上，还要部署 RMIStub 构件。由于 Java RMI 构件属
  于 JDK 1.8 的一部分。所以，在系统 JDK 环境已经设置好的情况下，不需要再独
  立部署。部署图如图所示。

![icon](http://assets.processon.com/chart_image/5ae5be27e4b039625af793c0.png?_=1554259679134)

## 架构设计

- 描述功能分解和如何在不同的层中安排软件模块
  - 描述架构中的对象，包含架构图
  - 描述组件接口信息
    - 包括：语法、前置条件、后置条件

### 模块职责

- 模块视图

  - 客户端模块视图

    ![](https://se-hw.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3%E5%9B%BEv.1/client%20module.png)

  - 服务器端模块视图

    ![](https://se-hw.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3%E5%9B%BEv.1/server%20module.png)

- 各层职责

  - 客户端各层职责

  |       层       | 职责                                 |
  | :------------: | ------------------------------------ |
  |    启动模块    | 负责初始化网络通信机制，启动用户界面 |
  |   用户界面层   | 展示课程学习网站界面                 |
  | 客户端网络模块 | 利用REST API连接服务器，获取资源     |

  - 服务器端各层职责

  |        层        | 职责                                           |
  | :--------------: | ---------------------------------------------- |
  |     启动模块     | 负责初始化网络通信机制，启动用户界面           |
  |      数据层      | 负责数据的持久化和数据访问接口                 |
  |    业务逻辑层    | 对于用户界面的输入进行响应并进行业务逻辑处理   |
  | 服务器端网络模块 | 利用REST API与客户端连接，提供客户端所需的资源 |

- 层之间调用接口

  | 接口                                                         | 服务调用方         | 服务提供方         |
  | ------------------------------------------------------------ | ------------------ | ------------------ |
  | CourseBLService, OrderBLService, UserBLService               | 客户端展示层       | 服务器端业务逻辑层 |
  | CourseDataService, OrderDataService, UserDataService, DatabaseFactory | 服务器端业务逻辑层 | 服务器端数据层     |

  - 讨论区用例层之间调用的接口

    ![](https://se-hw.oss-cn-shanghai.aliyuncs.com/interfaces%20called%20by%20sales%20%281%29.png)



### 用户界面层分解

- 根据当前需求，系统有如下界面：已购买课程界面。界面跳转如下图所示。

  ![](https://se-hw.oss-cn-shanghai.aliyuncs.com/UI.png)

- 类图

  服务器端和客户端之间的设计接口是一致的，只是具体的页面不同。用户界面类如下图所示。

  ![](https://se-hw.oss-cn-shanghai.aliyuncs.com/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3%E5%9B%BEv.1/userUIclass.png)

#### 职责

- 模块的职责

  下表所示为用户界面层模块的职责。

  |   模块    | 职责                                |
  | :-------: | ----------------------------------- |
  | MainFrame | 界面Frame，负责用户界面的显示和跳转 |

#### 接口规范

- 接口规范

  用户界面层模块的接口规范如下表所示。

| 接口名 |                |
| ------ | :------------- |
|        | **语法**：     |
|        | **前置条件：** |
|        | **后置条件：** |

- 需要的服务接口

  用户界面层所需要的服务接口如下表所示。

| 服务名 | 服务 |
| :----: | ---- |
|        |      |
|        |      |

### 业务逻辑层分解

业务逻辑层包括多个针对界面的业务逻辑处理对象。例如，post对象负责处理创建和查看帖子。

#### 职责

| 模块         | 职责                                           |
| ------------ | ---------------------------------------------- |
| discussionbl | 负责实现创建和查看论坛帖子以及评论、回复通知等 |


#### 接口规范

以下为discussionbl模块的接口规范：

<table style="border-collapse:collapse;border-spacing:0" class="tg"><tr><th style="font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" colspan="3">提供的服务（供接口）</th></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.getPostByPid</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">public PostVO<span style="font-weight:bold"> </span>getPostByPid(uid,postId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">pid符合输入规则</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">查找是否存在相应的评论，根据输入的帖子编号返回对应的帖子详情</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.getPostsByCid</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">PageInfo&lt;PostVO> getPostsByCid(page, Constant.POST_PAGE_SIZE,uid,courseId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">cid符合输入标准</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">按页返回符合条件的帖子列表</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.getCommentByPid</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">public List&lt;CommentVO> getCommentByPid(Integer postId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">postID符合输入标准</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">返回符合条件的评论列表</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.getReplyByPid</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">List&lt;ReplyVO> getReplyByPid(Integer postId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">postID符合输入标准</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">返回符合条件的回复列表</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.getReplyByUid</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">public<span style="font-weight:bold"> </span>List&lt;ReplyVO> getReplyByUid(Integer uid);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">uid符合输入标准</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">返回符合条件的回复列表</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.createPost</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">ResultVO&lt;PostVO><span style="font-weight:bold"> </span>createPost(PostVO postVO);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">无</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中插入一个post对象</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.createComment</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">ResultVO&lt;CommentVO><span style="font-weight:bold"> </span>createComment(CommentVO commentVO);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">无</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中插入一个comment对象</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.createReply</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">ResultVO&lt;ReplyVO><span style="font-weight:bold"> </span>createReply(ReplyVO replyVO);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">无</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中插入一个reply对象</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.updateLastCommentOrReplyTime</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">ResultVO&lt;PostVO><span style="font-weight:bold"> </span>updateLastCommentOrReplyTime(Integer postId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">postID符合输入标准</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">更新数据库中对应帖子的最后更新时间属性</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.setCommentIsNew2False</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle"><span style="font-weight:bold"> </span>ResultVO&lt;CommentVO> setCommentIsNew2False(uid,commentId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">commentID符合输入标准</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">更新数据库中对应评论的是否已读属性</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussion.setReplyIsNew2False</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">ResultVO&lt;ReplyVO&gt;<span style="font-weight:bold"> </span> setReplyIsNew2False(uid,commentId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">commentID符合输入标准</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">更新数据库中对应回复的是否已读属性</td></tr>
<tr><th style="font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" colspan="3">需要的服务（需接口）</th></tr></table>


|        服务名         | 服务                               |
| :-------------------: | ---------------------------------- |
|        getPost        | 查询单个帖子                       |
|      getPostList      | 查询该课程所有帖子                 |
|      getComment       | 查询该帖子所有评论                 |
|    getCommentReply    | 查询该帖子所有回复                 |
|       getReply        | 查询该用户所有回复                 |
|      createPost       | 发布帖子                           |
|     createComment     | 发布评论                           |
|      createReply      | 发布回复                           |
| updateLastCommentTime | 更新最后操作时间                   |
| setCommentIsNew2False | 更新数据库中对应评论的是否已读属性 |
|  setReplyIsNew2False  | 更新数据库中对应回复的是否已读属性 |

### 数据层分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。
各业务逻辑需要的服务由各 DataService 接口提供。

#### 职责

| 模块                  | 职责                                           |
| --------------------- | ---------------------------------------------- |
| discussionDataService | 持久化数据库的接口，提供集体保存、增删改查服务 |
| PostDataService       | 提供帖子对象的集体保存、增删改查服务           |
| CommentDataService    | 提供评论对象的集体保存、增删改查服务           |
| ReplyDataService      | 提供回复对象的集体保存、增删改查服务           |


#### 接口规范

以下为discussionDataService模块中post模块的接口规范，Comment、Reply与之类似：

<table style="border-collapse:collapse;border-spacing:0" class="tg"><tr><th style="font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" colspan="3">提供的服务（供接口）</th></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussionDataService.insert</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">int<span style="font-weight:bold"> </span>insert(Post record);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">同样的ID的对象在持久化数据库中不存在</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中增加一个post记录</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussionDataService.deleteByPrimaryKey</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">int<span style="font-weight:bold"> </span>deleteByPrimaryKey(Integer postId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">同样的ID的对象在持久化数据库中存在</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中删除这个post记录</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussionDataService.selectByPrimaryKey</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">Post<span style="font-weight:bold"> </span>selectByPrimaryKey(Integer postId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">同样的ID的对象在持久化数据库中存在</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中找到这个post记录并返回</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussionDataService.updateByPrimaryKey</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">Post<span style="font-weight:bold"> </span>updateByPrimaryKey(Integer postId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">同样的ID的对象在持久化数据库中存在</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中找到这个post记录并更新</td></tr>
<tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:middle" rowspan="3">discussionDataService.selectByCid</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">语法</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">List&lt;Post&gt;<span style="font-weight:bold"> </span> selectByCid(Integer courseId);</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">前置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:middle">同样的ID的course对象在持久化数据库中存在</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">后置条件</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">在数据库中找到这个课程编号对应的所有post记录并以列表的形式返回</td></tr>
</table>



### 信息视角

- 描述数据持久化对象(PO)

  - 系统的PO类就是对应的相关的实体类，在此只做简单的介绍。

    - PostPO类包括帖子id、帖子主题、帖子内容、帖子创建时间、所属课程id、楼主id、最后评论时间。
    - CommentPO类包括评论id、评论发布人id、所属帖子id、内容、发布时间、楼主是否已读`Boolean isNew`。
    - ReplyPO类包括回复id、回复人id、被回复人id、所回复评论id、回复内容、回复时间、被回复人是否已读。

  - 课程讨论区特别涉及的持久化用户对象有3个：Post，Comment，Reply。他们的定义如下所示。
  
    ```Java
    public class Post {
        private Integer postId;
    
        private String theme;
    
        private String content;
    
        private Date createTime;
    
        private Integer courseId;
    
        private Integer userId;
    
        private Date lastCommentTime;
    
        //getters,setters
        public Integer getPostId() {
            return postId;
        }
    
        public void setPostId(Integer postId) {
            this.postId = postId;
        }
    
        public String getTheme() {
            return theme;
        }
    
        public void setTheme(String theme) {
            this.theme = theme;
        }
    
        public String getContent() {
            return content;
        }
    
        public void setContent(String content){
            this.content=content;
        }
    
        public Integer getCourseId() {
            return courseId;
        }
    
        public void setCourseId(Integer courseId) {
            this.courseId = courseId;
        }
    
        public Integer getUserId() {
            return userId;
        }
    
        public void setUserId(Integer userId) {
            this.userId = userId;
        }
    
        public Date getCreateTime() {
            return createTime;
        }
    
        public void setCreateTime(Date createTime) {
            this.createTime = createTime;
        }
    
        public Date getLastCommentTime() {
            return lastCommentTime;
        }
    
        public void setLastCommentTime(Date lastCommentTime) {
            this.lastCommentTime = lastCommentTime;
        }
    
        //constructor
        public Post(){
    
        }
    
        public Post(PostVO postVO){
            this.postId=postVO.getPostId();
            this.theme= postVO.getTheme();
            this.content= postVO.getContent();
            this.courseId=postVO.getCourseId();
            this.userId= postVO.getUserId();
            this.createTime=postVO.getCreateTime();
            this.lastCommentTime=postVO.getLastCommentTime();
        }
    }
    ```
    
    ```java
    public class Comment {
        private Integer commentId;
    
        private Integer userId;
    
        private Integer postId;
    
        private String content;
    
        private Date createTime;
    
        private Boolean isNew;
    
        public Integer getCommentId() {
            return commentId;
        }
    
        public void setCommentId(Integer commentId) {
            this.commentId = commentId;
        }
    
        public Integer getUserId() {
            return userId;
        }
    
        public void setUserId(Integer userId) {
            this.userId = userId;
        }
    
        public Integer getPostId() {
            return postId;
        }
    
        public void setPostId(Integer postId) {
            this.postId = postId;
        }
    
        public String getContent() {
            return content;
        }
    
        public void setContent(String content) {
            this.content = content;
        }
    
        public Date getCreateTime() {
            return createTime;
        }
    
        public void setCreateTime(Date createTime) {
            this.createTime = createTime;
        }
    
        public Boolean getIsNew() {
            return isNew;
        }
    
        public void setIsNew(Boolean aNew) {
            this.isNew = aNew;
        }
    
        public Comment(){}
    
        public Comment(CommentVO commentVO){
            this.commentId=commentVO.getCommentId();
            this.postId=commentVO.getPostId();
            this.userId=commentVO.getUserId();
            this.content=commentVO.getContent();
            this.createTime=commentVO.getCreateTime();
            this.isNew=commentVO.getIsNew();
        }
    }
    ```
    
    ```java
    public class Reply {
        private Integer replyId;
    
        private Integer commentOwnerUid;
    
        private Integer userId;
    
        private Integer commentId;
    
        private String content;
    
        private Date createTime;
    
        private Boolean isNew;
    
        public Integer getCommentOwnerUid() {
            return commentOwnerUid;
        }
    
        public void setCommentOwnerUid(Integer commentOwnerUid) {
            this.commentOwnerUid = commentOwnerUid;
        }
    
        public Integer getReplyId() {
            return replyId;
        }
    
        public void setReplyId(Integer replyId) {
            this.replyId = replyId;
        }
    
        public Integer getCommentId() {
            return commentId;
        }
    
        public void setCommentId(Integer commentId) {
            this.commentId = commentId;
        }
    
        public Integer getUserId() {
            return userId;
        }
    
        public void setUserId(Integer userId) {
            this.userId = userId;
        }
    
        public String getContent() {
            return content;
        }
    
        public void setContent(String content) {
            this.content = content;
        }
    
        public Date getCreateTime() {
            return createTime;
        }
    
        public void setCreateTime(Date createTime) {
            this.createTime = createTime;
        }
    
        public Boolean getIsNew() {
            return isNew;
        }
    
        public void setIsNew(Boolean aNew) {
            isNew = aNew;
        }
    
        public Reply(){}
    
        public Reply(ReplyVO replyVO){
            this.replyId=replyVO.getReplyId();
            this.commentId=replyVO.getCommentId();
            this.content=replyVO.getContent();
            this.userId=replyVO.getUserId();
            this.createTime=replyVO.getCreateTime();
            this.isNew=replyVO.getIsNew();
            this.commentOwnerUid=replyVO.getCommentOwnerUid();
        }
    }
    
    ```
    
    